
<!DOCTYPE html>
<html lang="en-us">
  <head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="utf-8">

  <title>Tailoring MCU SDK to resource-limited platform - Gizwits</title>

  <meta http-equiv="X-UA-Compatible" content="IE=Edge, chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <meta name="Description" content="Tailoring MCU SDK to resource-limited platform-Gizwits">
  <meta name="keywords" content="Tailoring MCU SDK to resource-limited platform docs 文档中心 Gizwits">

  <link rel="shortcut icon" href="/images/favicon.png" type="image/x-icon">
  <script src="/js/redirect.js"></script>

  <link rel="stylesheet" href="/css/pure.min.css">
  <link rel="stylesheet" href="/css/font-awesome.min.css">
  <link rel="stylesheet" href="/css/documentation.css?v=db6111caa3d210b6cb1d2dac5119d7c5">
  <link rel="stylesheet" href="/css/share.min.css">
</head>
  <body>
    <div class="header">
  <div class="container pure-g">
    <span class="brand pure-u-5-24">
      <a href="http://www.gizwits.com" class="logo">
      
      <img src="/images/logo_en.png" alt="logo">
      
      </a>
      <a class="text" href="/">Docs</a>
    </span>

    <div class="mobile-header" v="">
      <span class="title">Gizwits Docs</span>
      <i class="fa fa-caret-square-o-down fa-lg" aria-hidden="true"></i>
    </div>

    <span class="menu pure-u-16-24">
      <span class="header-search-btn" id="header-search-btn">
        <i class="fa fa-search"></i>
      </span>
      <ul class="levelA-wrapper">
        
      </ul>
    </span>

    <span class="pure-u-3-24 lang-switch-wrapper">

      <i class="fa fa-globe" aria-hidden="true"></i>
      
      <a href="/zh-cn/overview/overview.html" class="lang-switch" data-lang="zh-cn">中文</a>
      
    </span>
  </div>

  <div class="header-search-panel" id="header-search-panel">
    <span class="header-search-close" id="header-search-close"><i class="fa fa-times" aria-hidden="true"></i></span>
    <div class="header-search-input-wrap" id="header-search-input-wrap">
      <input type="text" class="header-search-input" id="header-search-input" placeholder="请输入关键字">
      <span class="header-search-input-icon"><i class="fa fa-search"></i></span>
    </div>

    <div class="header-search-trend" id="header-search-trend">
      <div class="header-search-trend-title">热搜词</div>
      <div class="header-search-trend-items clearfix">
        
        <div class="header-search-trend-item" data-word="APP">APP</div>
        
        <div class="header-search-trend-item" data-word="SDK">SDK</div>
        
        <div class="header-search-trend-item" data-word="Android">Android</div>
        
        <div class="header-search-trend-item" data-word="ios">ios</div>
        
        <div class="header-search-trend-item" data-word="WIFI">WIFI</div>
        
      </div>
    </div>

    <div class="header-search-result hidden" id="header-search-result">
      <div class="header-search-result-head">
        搜索结果 &gt; <span id="header-search-keyword"></span>
      </div>
      <div class="header-search-result-items" id="header-search-result-items">
      </div>
    </div>
  </div>
</div>

    <div class="body">

  <div class="container clearfix">
    <div class="navigation">
      <div class="navigation-inner">
        <div class="nav-title">Content</div>
        <div class="nav"></div>
      </div>
    </div>
    <div class="markdown-body" data-spy="scroll" data-target=".navigation">
      <div class="heading">
        <div class="title">Tailoring MCU SDK to resource-limited platform</div>
        <a class="edit-link" target="_blank"><i class="fa fa-github" aria-hidden="true"></i> Edit</a>
      </div>
      <h1 id="1-Overview"><a href="#1-Overview" class="headerlink" title="1. Overview"></a>1. Overview</h1><p>Due to the limited on-chip resources of the 8051 and other MCUs (take the STC15F2K60S2 as an example, the SRAM size is 2K = 2048 bytes), when more product Data Points are defined in the Gizwits IoT Cloud, there is not much free memory for the compiled program, causing the abnormality of serial data parsing and getting the program stuck, etc. For the STC15F2K60S2 platform, the Data Point length is recommended to be less than 20 bytes, and the corresponding RAM usage should be within 60%.</p>
<p>For developers who want to further reduce memory consumption, this document provides a way of “Tailoring MCU SDK to resource-limited platform”.</p>
<p>This document describes how to tailor the automatically generated MCU code to save more hardware resources for application layer development or port to a platform with more limited resources (such as a MCU with 1K SRAM).</p>
<p>Before reading this document, you are advised to have a deep understanding of the Gizwits standalone MCU scheme. Please refer to the document “Gokit-MCU program with explanation”. This document will not elaborate on the implementation of the MCU program. </p>
<p>Below are the tailoring steps.</p>
<h1 id="2-Check-the-resource-usage-of-the-source-code-project"><a href="#2-Check-the-resource-usage-of-the-source-code-project" class="headerlink" title="2. Check the resource usage of the source code project"></a>2. Check the resource usage of the source code project</h1><p>First, define the corresponding Data Points:</p>
<p><img src="../../../assets/en-us/DeviceDev/8051/11.png" alt="Tailoring MCU code"></p>
<p>Next, generate the source code project for the STC15F2K60S2 platform:</p>
<p><img src="../../../assets/en-us/DeviceDev/8051/12.png" alt="Tailoring MCU code"> </p>
<p>The method to check the Data Point length: download “xxx- Gizwits standalone MCU scheme communication protocol document” in the Developer Center, and you can see that the sum of “attr_flags” + “attr_vals” in “3.2 Wi-Fi module controls device” is the total size of the Data Point length (in bytes):</p>
<p><img src="../../../assets/en-us/DeviceDev/8051/13.png" alt="Tailoring MCU code"> </p>
<p>You can see that the Data Point length is 2 bytes.</p>
<p>The SRAM usage of the compiled program is as shown in the following figure:</p>
<p><img src="../../../assets/en-us/DeviceDev/8051/14.png" alt="Tailoring MCU code"> </p>
<p>It can be seen that the SRAM usage corresponding to the defined Data Points is 988 bytes (the total size of STC15F2K60S2 SRAM is 2048 bytes).</p>
<p>If you want to further reduce memory usage, it needs to tailor the MCU SDK to meet the limited hardware resources requirement.</p>
<h1 id="3-Tailoring-MCU-SDK-to-resource-limited-platform"><a href="#3-Tailoring-MCU-SDK-to-resource-limited-platform" class="headerlink" title="3. Tailoring MCU SDK to resource-limited platform"></a>3. Tailoring MCU SDK to resource-limited platform</h1><h2 id="3-1-Remove-transparent-transmission-code"><a href="#3-1-Remove-transparent-transmission-code" class="headerlink" title="3.1 Remove transparent transmission code"></a>3.1 Remove transparent transmission code</h2><ul>
<li>Remove the fields for transparent transmission in the global structure:</li>
</ul>
<p><img src="../../../assets/en-us/DeviceDev/8051/15.png" alt="Tailoring MCU code"> </p>
<ul>
<li>Comment out the corresponding code:</li>
</ul>
<p><img src="../../../assets/en-us/DeviceDev/8051/16.png" alt="Tailoring MCU code"> </p>
<p><img src="../../../assets/en-us/DeviceDev/8051/17.png" alt="Tailoring MCU code"></p>
<p>Reduce memory usage by 26 bytes:</p>
<p><img src="../../../assets/en-us/DeviceDev/8051/18.png" alt="Tailoring MCU code"> </p>
<h2 id="3-2-Remove-Data-Point-Event-Processing-code"><a href="#3-2-Remove-Data-Point-Event-Processing-code" class="headerlink" title="3.2 Remove Data Point Event Processing code"></a>3.2 Remove Data Point Event Processing code</h2><ul>
<li>Remove the fields for Data Point Event Processing in the global structure:</li>
</ul>
<p><img src="../../../assets/en-us/DeviceDev/8051/19.png" alt="Tailoring MCU code"> </p>
<ul>
<li>Remove the corresponding code:</li>
</ul>
<p>Tip: You can search for keywords globally, such as: issuedProcessEvent.</p>
<p><img src="../../../assets/en-us/DeviceDev/8051/20.png" alt="Tailoring MCU code"></p>
<p><img src="../../../assets/en-us/DeviceDev/8051/21.png" alt="Tailoring MCU code"> </p>
<ul>
<li>Modify the handler for converting p0 data to event:</li>
</ul>
<p><img src="../../../assets/en-us/DeviceDev/8051/22.png" alt="Tailoring MCU code"> </p>
<p>Reduce memory usage by 19 bytes:</p>
<p><img src="../../../assets/en-us/DeviceDev/8051/23.png" alt="Tailoring MCU code"> </p>
<ul>
<li>Remove the global variable p0 of the user area (replaced with the global variable p0 of the common protocol area):</li>
</ul>
<p><img src="../../../assets/en-us/DeviceDev/8051/24.png" alt="Tailoring MCU code"> </p>
<p><img src="../../../assets/en-us/DeviceDev/8051/25.png" alt="Tailoring MCU code"> </p>
<p><img src="../../../assets/en-us/DeviceDev/8051/26.png" alt="Tailoring MCU code"></p>
<ul>
<li>Comment out Control Event Processing code:</li>
</ul>
<p><img src="../../../assets/en-us/DeviceDev/8051/27.png" alt="Tailoring MCU code"> </p>
<p>Reduce memory usage by 2 bytes:</p>
<p><img src="../../../assets/en-us/DeviceDev/8051/28.png" alt="Tailoring MCU code"> </p>
<ul>
<li>Add processing logic to the function of converting p0 data to event :</li>
</ul>
<p><img src="../../../assets/en-us/DeviceDev/8051/29.png" alt="Tailoring MCU code"> </p>
<h2 id="3-3-Remove-log-output-function"><a href="#3-3-Remove-log-output-function" class="headerlink" title="3.3 Remove log output function"></a>3.3 Remove log output function</h2><p>For the MCU platforms like Arduino, when using log output, the print content will be stored in RAM by default, so it will take up a large amount of memory temporarily.</p>
<p>Note: The STC15F2K60S2 platform does not have this problem, and its print content will be stored in the code area, i.e., FLASH, and does not occupy the memory space of the xdata area.</p>
<p>You can comment out the log output code or modify the redirect macro to remove the log output function:</p>
<p><img src="../../../assets/en-us/DeviceDev/8051/30.png" alt="Tailoring MCU code"> </p>
<h1 id="4-Summary"><a href="#4-Summary" class="headerlink" title="4. Summary"></a>4. Summary</h1><p>The section above meets the limited hardware resources requirement by tailoring transparent transmission, the conversion of Data Point into event, and user area global variables. </p>
<p>From the tailoring example above, we see that when only one Boolean Data Point is defined, the Data Point length in the protocol is as follows:</p>
<p><img src="../../../assets/en-us/DeviceDev/8051/31.png" alt="Tailoring MCU code"> </p>
<p>You can see that the Data Point length is 2 bytes.</p>
<p>The memory usage has been reduced from 988 bytes to 941 bytes, reducing the total memory usage by 47 bytes.</p>
<p>It has been tested that when defining an extension type Data Point of 20 bytes, the Data Point length in the protocol is as follows:</p>
<p><img src="../../../assets/en-us/DeviceDev/8051/32.png" alt="Tailoring MCU code"></p>
<p>You can see that the Data Point length is 21 bytes.</p>
<p>Similarly, the memory usage can be reduced from 1332 bytes to 1248 bytes, reducing the memory usage by 84 bytes.</p>
<p>Conclusion: The more Data Points you define, the more memory you will save by this way.</p>

    </div>
    
    <div class="widget-wrapper">
  <span class="widget">
    <div>
        <a id="share" target="_blank" title="Share">
          <span>Share</span>
        </a>
        <div class="social-share" data-initialized="true">
            <a href="#" class="social-share-icon icon-wechat"></a>
            <a href="#" class="social-share-icon icon-weibo"></a>
            <a href="#" class="social-share-icon icon-qq"></a>
            <a href="#" class="social-share-icon icon-qzone"></a>
            <a href="#" class="social-share-icon icon-douban"></a>
        </div>
    </div>
    <a href="http://y0.cn/docs" target="_blank" title="Register">
      <span>Register</span>
    </a>
    <a href="https://github.com/gizwits-docs/gizwits-docs/issues" target="_blank" title="Feed back">
      <span>Feed back</span>
    </a>
    <a href="#" title="Top"><i class="fa fa-angle-up fa-2x" aria-hidden="true"></i></a>
  </span>
</div>
  </div>
</div>

    <div class="footer">
  <div class="container">
    <p>
      <span><a href="http://www.gizwits.com" target="_blank">HOME</a></span>
      <span><a href="http://www.gizwits.com/about-us" target="_blank">ABOUT</a></span>
      <span><a href="http://www.gizwits.com/about-us#contact-us" target="_blank">CONTACT</a></span>
      <span><a href="http://www.gizwits.com/join-us" target="_blank">JOIN</a></span>
    </p>
    <p>&#169;2011-2017; Gizwits IoT Technology Co., Ltd. 粤ICP备11090211号</p>
  </div>
</div>

    <script src="/js/spin.min.js"></script>
<script src="/js/jquery.min.js"></script>
<script src="/js/jquery.hashchange.min.js"></script>
<script src="/js/clipboard.min.js"></script>
<script src="/js/scrollspy.js"></script>
<script src="/js/social-share.min.js"></script>
<script src="/js/documentation.js?v=d413cf8ceca4865c39c2dabcd3bc0077"></script>


<script type="text/javascript" src="http://webchat.7moor.com/javascripts/7moorInit.js?accessId=b01e0430-943a-11e6-8ad7-636675d9e71f&autoShow=true" async="async"></script>


<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?3787e6b3b29a084fde41f22828d89b7d";
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(hm, s);
})();
</script>
  </body>
</html>