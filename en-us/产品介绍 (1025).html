
<!DOCTYPE html>
<html lang="en-us">
  <head>
  <meta charset="utf-8">

  <title>Gizwits</title>

  <meta http-equiv="X-UA-Compatible" content="IE=Edge, chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <meta name="Description" content="-Gizwits">
  <meta name="keywords" content=" docs 文档中心 Gizwits">

  <link rel="shortcut icon" href="/images/favicon.png" type="image/x-icon">
  <script src="/js/redirect.js"></script>

  <link rel="stylesheet" href="/css/pure.min.css">
  <link rel="stylesheet" href="/css/font-awesome.min.css">
  <link rel="stylesheet" href="/css/documentation.css?v=db6111caa3d210b6cb1d2dac5119d7c5">
  <link rel="stylesheet" href="/css/share.min.css">
</head>
  <body>
    <div class="header">
  <div class="container pure-g">
    <span class="brand pure-u-5-24">
      <a href="http://www.gizwits.com" class="logo">
      
      <img src="/images/logo_en.png" alt="logo">
      
      </a>
      <a class="text" href="/">Docs</a>
    </span>

    <div class="mobile-header"v>
      <span class="title">Gizwits Docs</span>
      <i class="fa fa-caret-square-o-down fa-lg" aria-hidden="true"></i>
    </div>

    <span class="menu pure-u-16-24">
      <span class="header-search-btn" id="header-search-btn">
        <i class="fa fa-search"></i>
      </span>
      <ul class="levelA-wrapper">
        
          
            <li class="levelA"><a href="/en-us/overview/overview.html">Overview</a></li>
          
        
          
            <li class="levelA">
              Quick Start &#9662;
              <ul class="levelB-wrapper">
                
                  
                    <li class="levelB"><a href="/en-us/quickstart/readme.html">Intro in 5 mins</a></li>
                  
                
                  
                    <li class="levelB"><a href="/en-us/quickstart/glossary.html">Glossary</a></li>
                  
                
              </ul>
            </li>
          
        
          
            <li class="levelA">
              App Dev Guide &#9662;
              <ul class="levelB-wrapper">
                
                  
                    <li class="levelB"><a href="/en-us/quickstart/AppDevPrepare.html">App development preparation and guidance</a></li>
                  
                
                  
                    <li class="levelB"><a href="/en-us/UserManual/devApp.html">App code auto-generator</a></li>
                  
                
                  
                    <li class="levelB has-submenu">
                      APP Frame Guide &#9656;
                      <ul class="levelC-wrapper">
                        
                          <li class="levelC"><a href="/en-us/AppDev/iOSSDKA2.html">iOS SDK A2</a></li>
                        
                          <li class="levelC"><a href="/en-us/AppDev/iOSPushNotification.html">iOS Push Notification</a></li>
                        
                          <li class="levelC"><a href="/en-us/AppDev/iOSAuthReSkin.html">iOS Auth Re Skin</a></li>
                        
                          <li class="levelC"><a href="/en-us/AppDev/iosframe.html">Quick start of iOS App development</a></li>
                        
                          <li class="levelC"><a href="/en-us/AppDev/AndroidSDKA2.html">Android SDK A2</a></li>
                        
                          <li class="levelC"><a href="/en-us/AppDev/androidframe.html">Android frame</a></li>
                        
                          <li class="levelC"><a href="/en-us/AppDev/AndroidPushNotification.html">Android Push Notification</a></li>
                        
                          <li class="levelC"><a href="/en-us/quickstart/AndroidAppFrame.html">Quick start of Android App development</a></li>
                        
                          <li class="levelC"><a href="/en-us/AppDev/APICloudFrame.html">API Cloud Frame</a></li>
                        
                          <li class="levelC"><a href="/en-us/AppDev/VideoTutorial.html">Video tutorial of the App open source framework</a></li>
                        
                      </ul>
                    </li>
                  
                
                  
                    <li class="levelB has-submenu">
                      App SDK Guide &#9656;
                      <ul class="levelC-wrapper">
                        
                          <li class="levelC"><a href="/en-us/AppDev/iOSSDKA2.html">iOS SDK</a></li>
                        
                          <li class="levelC"><a href="/en-us/AppDev/AndroidSDKA2.html">Android SDK</a></li>
                        
                          <li class="levelC"><a href="/en-us/AppDev/APICloudWifiSDK.html">APICloud SDK</a></li>
                        
                          <li class="levelC"><a href="/en-us/AppDev/SDKTransparentTransmission.html">Data transparent transmission of SDK</a></li>
                        
                          <li class="levelC"><a href="/en-us/AppDev/SDKLogCapture.html">SDK debug log capture</a></li>
                        
                          <li class="levelC"><a href="/en-us/AppDev/sdk_error.html">SDK error codes</a></li>
                        
                      </ul>
                    </li>
                  
                
                  
                    <li class="levelB"><a href="/en-us/WechatDev/WeChatDev.html">WeChat SDK Guide</a></li>
                  
                
                  
                    <li class="levelB"><a href="/en-us/WechatDev/WechatDevIntro.html">WeChat Dev Intro</a></li>
                  
                
                  
                    <li class="levelB has-submenu">
                      More Guide &#9656;
                      <ul class="levelC-wrapper">
                        
                          <li class="levelC"><a href="/en-us/cloud/SharingSDK.html">Gizwits Device Sharing</a></li>
                        
                          <li class="levelC"><a href="/en-us/AppDev/third-party.html">Application process for third-party authentication</a></li>
                        
                      </ul>
                    </li>
                  
                
                  
                    <li class="levelB"><a href="/en-us/AppDev/AppDevFAQ.html">App Dev FAQ</a></li>
                  
                
              </ul>
            </li>
          
        
          
            <li class="levelA">
              DeviceDev &#9662;
              <ul class="levelB-wrapper">
                
                  
                    <li class="levelB"><a href="/en-us/DeviceDev/DeviceDevIntro.html">Get started with device connection</a></li>
                  
                
                  
                    <li class="levelB has-submenu">
                      Gizwits Cloud access &#9656;
                      <ul class="levelC-wrapper">
                        
                          <li class="levelC"><a href="/en-us/quickstart/UseMCU.html">MCU scheme</a></li>
                        
                          <li class="levelC"><a href="/en-us/DeviceDev/UseSOC.html">ESP8266-SoC scheme</a></li>
                        
                      </ul>
                    </li>
                  
                
                  
                    <li class="levelB"><a href="/en-us/module_source/module_source.html">Module Documents</a></li>
                  
                
                  
                    <li class="levelB has-submenu">
                      GAgent Documents &#9656;
                      <ul class="levelC-wrapper">
                        
                          <li class="levelC"><a href="/en-us/DeviceDev/gagent_info.html">Detailed annotation of GAgent</a></li>
                        
                          <li class="levelC"><a href="/en-us/DeviceDev/DebugTool.html">Firmware downloading on modules</a></li>
                        
                          <li class="levelC"><a href="/en-us/DeviceDev/debug/HF-LPB100.html">HF-LPB100</a></li>
                        
                          <li class="levelC"><a href="/en-us/DeviceDev/debug/HF-LPT120.html">HF-LPT120</a></li>
                        
                          <li class="levelC"><a href="/en-us/DeviceDev/debug/MXCHIP.html">MXCHIP</a></li>
                        
                          <li class="levelC"><a href="/en-us/DeviceDev/debug/ESP8266.html">ESP8266</a></li>
                        
                      </ul>
                    </li>
                  
                
              </ul>
            </li>
          
        
          
            <li class="levelA">
              Cloud API &#9662;
              <ul class="levelB-wrapper">
                
                  
                    <li class="levelB"><a href="/en-us/cloud/OpenAPI.html">Open API</a></li>
                  
                
                  
                    <li class="levelB"><a href="/en-us/cloud/ent_dev.html">Enterprise Application Development</a></li>
                  
                
                  
                    <li class="levelB"><a href="/en-us/cloud/enterprise_api.html">Enterprise API</a></li>
                  
                
                  
                    <li class="levelB"><a href="/en-us/cloud/NotificationAPI.html">Notification API</a></li>
                  
                
                  
                    <li class="levelB"><a href="/en-us/cloud/WebsocketAPI.html">WebsocketAPI</a></li>
                  
                
                  
                    <li class="levelB has-submenu">
                      API Tutorial &#9656;
                      <ul class="levelC-wrapper">
                        
                          <li class="levelC"><a href="/en-us/UserManual/UseOpenAPI.html">Using Open API to control virtual device with Postman</a></li>
                        
                          <li class="levelC"><a href="/en-us/UserManual/UseSNoti.html">Real-time data synchronization demo for SNoti service</a></li>
                        
                          <li class="levelC"><a href="/en-us/UserManual/UseWebsocket.html">Control device using WebSocket</a></li>
                        
                          <li class="levelC"><a href="/en-us/UserManual/DataAPI.html">Aggregation API Guide</a></li>
                        
                          <li class="levelC"><a href="/en-us/UserManual/LinkageAPI.html">Device Linkage API Tutorial</a></li>
                        
                          <li class="levelC"><a href="/en-us/UserManual/devgroup_API.html">Device Grouping API Tutorial</a></li>
                        
                          <li class="levelC"><a href="/en-us/UserManual/UseQRCode.html">Generating device QR code for App binding</a></li>
                        
                      </ul>
                    </li>
                  
                
                  
                    <li class="levelB"><a href="/en-us/cloud/CloudFAQ.html">Cloud FAQ</a></li>
                  
                
              </ul>
            </li>
          
        
          
            <li class="levelA">
              User Manual &#9662;
              <ul class="levelB-wrapper">
                
                  
                    <li class="levelB"><a href="/en-us/UserManual/ST_IoT.html">Gizwits and ST Make IoT Development Easy</a></li>
                  
                
              </ul>
            </li>
          
        
      </ul>
    </span>

    <span class="pure-u-3-24 lang-switch-wrapper">

      <i class="fa fa-globe" aria-hidden="true"></i>
      
      <a href="/zh-cn/overview/overview.html" class="lang-switch" data-lang="zh-cn">中文</a>
      
    </span>
  </div>

  <div class="header-search-panel" id="header-search-panel">
    <span class="header-search-close" id="header-search-close"><i class="fa fa-times" aria-hidden="true"></i></span>
    <div class="header-search-input-wrap" id="header-search-input-wrap">
      <input type="text" class="header-search-input" id="header-search-input" placeholder="请输入关键字">
      <span class="header-search-input-icon"><i class="fa fa-search"></i></span>
    </div>

    <div class="header-search-trend" id="header-search-trend">
      <div class="header-search-trend-title">热搜词</div>
      <div class="header-search-trend-items clearfix">
        
        <div class="header-search-trend-item" data-word="APP">APP</div>
        
        <div class="header-search-trend-item" data-word="SDK">SDK</div>
        
        <div class="header-search-trend-item" data-word="Android">Android</div>
        
        <div class="header-search-trend-item" data-word="ios">ios</div>
        
        <div class="header-search-trend-item" data-word="WIFI">WIFI</div>
        
      </div>
    </div>

    <div class="header-search-result hidden" id="header-search-result">
      <div class="header-search-result-head">
        搜索结果 &gt; <span id="header-search-keyword"></span>
      </div>
      <div class="header-search-result-items" id="header-search-result-items">
      </div>
    </div>
  </div>
</div>

    <div class="body">

  <div class="container clearfix">
    <div class="navigation">
      <div class="navigation-inner">
        <div class="nav-title">Content</div>
        <div class="nav"></div>
      </div>
    </div>
    <div class="markdown-body" data-spy="scroll" data-target=".navigation">
      <div class="heading">
        <div class="title"></div>
        <a class="edit-link" target="_blank"><i class="fa fa-github" aria-hidden="true"></i> Edit</a>
      </div>
      <h1 id="产品介绍"><a href="#产品介绍" class="headerlink" title="产品介绍"></a>产品介绍</h1><p>基于ST和机智云的I-cube-gizwits软件包运行在基于ARM Cortex-M处理器的STM32微控制器上。</p>
<p>I-cube-gizwits软件包嵌入了机智云的GAgent，设备可以通过GAgent访问机智云云平台。GAgent主要的作用是数据转发，是设备数据、机智云、应用端（APP）的数据交互桥梁。GAgent提供了机智云云平台与单片机之间的通信协议，开发者可以根据该协议实现MCU与GAgent之间的通信。</p>
<p>用户可以通过手机连接到机智云云平台，并且可以随时随地获取设备的信息以及对设备进行控制。<br>I-cube-gizwits软件包是STM32 Cube的扩展软件包，基于STM32 Cube HAL库。</p>
<h1 id="产品优势"><a href="#产品优势" class="headerlink" title="产品优势"></a>产品优势</h1><ol>
<li>基于STM32 Cube，图形化操作，能够快速配置MCU外设，以及工程配置，提高开发效率。</li>
<li>支持导出多个格式的工程：<br>IAR Embedded Workbench for ARM ;<br>KEIL uVision;<br>System Workbench for STM32;</li>
<li>采用平台无关API，MCU/WIFI芯片平台切换成本低；</li>
<li>嵌入式机智云GAgent联网服务，自动完成了联网功能，能够快速玩转机智云物联网云平台；</li>
</ol>
<h1 id="准备工作"><a href="#准备工作" class="headerlink" title="准备工作"></a>准备工作</h1><h3 id="1-硬件："><a href="#1-硬件：" class="headerlink" title="1. 硬件："></a>1. 硬件：</h3><p>1）B-L475E-IOT01A2开发板</p>
<p>2）Micro USB线</p>
<h3 id="2-软件："><a href="#2-软件：" class="headerlink" title="2. 软件："></a>2. 软件：</h3><p>   下面三种开发工具任选其一：<br>1）    IAR Embedded Workbench for ARM<br>2）    KEIL uVision5<br>3）    System Workbench for STM32</p>
<h3 id="3-其他："><a href="#3-其他：" class="headerlink" title="3. 其他："></a>3. 其他：</h3><p>1）机智云开发者账号<br>2）I-cube-gizwits固件包<br>3）I-cube-gizwits固件包文件夹结构简介：</p>
<h1 id="开始开发"><a href="#开始开发" class="headerlink" title="开始开发"></a>开始开发</h1><h3 id="1-注册开发者账号"><a href="#1-注册开发者账号" class="headerlink" title="1. 注册开发者账号"></a><strong>1. 注册开发者账号</strong></h3><p>机智云开发者账号，用于产品接入、设备管理、OTA服务、MCU开发等的功能使用。<br>注册链接：<a href="http://dev.gizwits.com/zh-cn/developer/" target="_blank" rel="noopener">http://dev.gizwits.com/zh-cn/developer/</a></p>
<h3 id="2-新建产品"><a href="#2-新建产品" class="headerlink" title="2. 新建产品"></a><strong>2. 新建产品</strong></h3><p>注册完成后，登陆至机智云开发者中心后台后，点击开发者中心后台中间的“创建新产品”菜单，在跳转页面新建一个名为“GizTest”的产品(名称可自定)，选择“Wi-Fi/移动网络方案”方式接入，并完成产品创建。如下图：</p>
<h3 id="3-创建云端数据点（产品功能点）"><a href="#3-创建云端数据点（产品功能点）" class="headerlink" title="3. 创建云端数据点（产品功能点）"></a><strong>3. 创建云端数据点（产品功能点）</strong></h3><p><strong>数据点介绍：</strong></p>
<p>   即设备产品的功能的抽象，用于描述产品功能及其参数。创建数据点后，设备与云端通讯的数据格式即可确定，设备、机智云可以相互识别设备与机智云互联互通的数据。更多的解析和新建指引，可以在开发者中心数据点页面右上角“定义数据点教程”中查看找到帮助，以建立属于你自己产品的数据点，如下图：</p>
<p><strong>新建数据点：</strong></p>
<p>然后以本次的项目“GizTest”为例，简单描述一下云端数据点和产品的功能点的关系，本次的项目“GizTest”，它需要实现的功能是：</p>
<p>（1）    获取开发板陀螺仪X、Y、Z轴数值；<br>（2）    获取开发板相对湿度和温度传感器数值；<br>（3）    获取开发板LED的状态以及控制LED开关；</p>
<p>那我们需要在云端建立对应的数据点，如下图：</p>
<p>下表是所有数据点的具体设置：</p>
<p>添加数据点完成之后，点击下图的“应用”即可，完成整个产品的数据点的新建工作。</p>
<h3 id="4-GAgent-API简介"><a href="#4-GAgent-API简介" class="headerlink" title="4. GAgent API简介"></a><strong>4. GAgent API简介</strong></h3><h4 id="gagent-soc-h文件中API"><a href="#gagent-soc-h文件中API" class="headerlink" title="gagent_soc.h文件中API"></a>gagent_soc.h文件中API</h4><p>（1）gagent_soc.h文件内容预览<br>（2）API功能简介<br>    <strong>1）gagentInit</strong></p>
<ul>
<li>功能：gagent相关参数初始化</li>
<li>函数定义：void gagentInit(struct devAttrs attrs)</li>
<li><p>参数：struct devAttrs attrs ：对应初始化参数的结构体</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">struct devAttrs&#123;</span><br><span class="line">    unsigned short mBindEnableTime;</span><br><span class="line">    unsigned char mstrProtocolVer[MCU_PROTOCOLVER_LEN];</span><br><span class="line">    unsigned char mstrP0Ver[MCU_P0VER_LEN];</span><br><span class="line">    unsigned char mstrDevHV[MCU_HARDVER_LEN];</span><br><span class="line">    unsigned char mstrDevSV[MCU_SOFTVER_LEN];</span><br><span class="line">    unsigned char mstrProductKey[PK_LEN];</span><br><span class="line">    unsigned char mstrPKSecret[PKS_LEN];</span><br><span class="line">    unsigned char mDevAttr[MCUATTR_LEN];</span><br><span class="line">    unsigned char mstrSdkVerLow[SDK_USER_VER_LEN];</span><br><span class="line">       //gagent 微信公众号ID,默认为机智云微信宠物屋ID</span><br><span class="line">            uint8 *szWechatDeviceType;</span><br><span class="line">       //gagent 默认连接服务器域名</span><br><span class="line">            uint8 *szGAgentSever;</span><br><span class="line">       //gagent 默认连接服务器端口，默认为80</span><br><span class="line">            uint32 *gagentSeverPort;</span><br><span class="line">       //gagent softap Name ,默认值:XPG-GAgent-xxxx(后面4位为MAC后4位)</span><br><span class="line">            uint8 *szGAgentSoftApName;</span><br><span class="line">       //gagent softap 密码 ,默认值:123456789，若内容为空则热点不加密;</span><br><span class="line">            uint8 *szGAgentSoftApPwd;</span><br><span class="line">       //m2m keepalive 默认值 120s</span><br><span class="line">            uint32 *m2mKeepAliveS;</span><br><span class="line">       //m2m 心跳间隔 默认值为 50s</span><br><span class="line">            uint32 *m2mHeartbeatIntervalS;</span><br><span class="line">       //gagent 时区秒，默认为东八区:8*(60*60)</span><br><span class="line">            int32 *timeZoneS;</span><br><span class="line">       //串口心跳间隔S，默认值 55秒</span><br><span class="line">            uint32 *localHeartbeatIntervalS;</span><br><span class="line">       //串口数据传送ACK时间，默认值600ms+数据长度耗时</span><br><span class="line">            uint32 *localTransferIntervalMS;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
</li>
<li><p>返回：无</p>
</li>
</ul>
<p><strong>2）gagentUploadData</strong></p>
<ul>
<li>功能：上传数据到客户端</li>
<li>函数定义：<br>int32 gagentUploadData(uint8 <em>szDID, uint8 </em>src, uint32 len,uint8 flag, void *arg,gagentUploadDataCb fun )</li>
<li><p>参数：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"> uint8 *szDID	：要上传的数据对应的设备DID</span><br><span class="line">                （本平台[B-L475E-IOT01A2]szDID参数请设置为NULL）</span><br><span class="line"> uint8 *src    ：要上传数据的内容指针</span><br><span class="line"> uint32 len    ：上传数据的大小</span><br><span class="line"> uint8 flag   	：1:数据大小循环通道都需要上传</span><br><span class="line">      		      0:数据只上传小循环</span><br><span class="line">                （本平台[B-L475E-IOT01A2]flag参数请设置为1）</span><br><span class="line"> void *arg 	：上传数据回调函数的参数，不能为NULL</span><br><span class="line">gagentUploadDataCb fun ：上传数据的结果回调函数</span><br></pre></td></tr></table></figure>
</li>
<li><p>返回：<br>GAT_OK           0      成功<br>GAT_ERR_FAIL    -1      失败</p>
<p><strong>3）gagentGetNTP</strong></p>
<ul>
<li>功能：获取NTP时间</li>
<li>函数定义：void gagentGetNTP(_tm *time)</li>
<li>参数：<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">_tm *time       ：保存获取的NTP时间的结构体指针</span><br><span class="line">typedef struct</span><br><span class="line">&#123;</span><br><span class="line">    uint16 year;</span><br><span class="line">    uint8 month;</span><br><span class="line">    uint8 day;</span><br><span class="line">    uint8 hour;</span><br><span class="line">    uint8 minute;</span><br><span class="line">    uint8 second;</span><br><span class="line">    uint32 ntp;</span><br><span class="line">&#125;_tm;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>返回：无</p>
</li>
</ul>
<p><strong>4）gagentReset</strong></p>
<ul>
<li>功能：重置模组，会清除配置信息和解除用户与之间的关系，该函数会导致模组重启</li>
<li>函数定义：void gagentReset(void)</li>
<li>参数：无</li>
<li>返回：无</li>
</ul>
<h3 id="5-项目源码修改"><a href="#5-项目源码修改" class="headerlink" title="5. 项目源码修改"></a><strong>5. 项目源码修改</strong></h3><h4 id="5-1-打开工程文件-下面以IAR-Embedded-Workbench-for-ARM为例"><a href="#5-1-打开工程文件-下面以IAR-Embedded-Workbench-for-ARM为例" class="headerlink" title="5.1 打开工程文件(下面以IAR Embedded Workbench for ARM为例)"></a>5.1 打开工程文件(下面以IAR Embedded Workbench for ARM为例)</h4><p>（1）安装好IAR Embedded Workbench for ARM 软件<br>（2）解压I-cube-gizwits固件包，打开路径 Gizwits_V1.1.1_Lib\Projects\B-L475E-IOT01\Applications\Cloud\Gizwits\EWARM 下的  Project.eww 文件</p>
<h4 id="5-2-基本信息修改"><a href="#5-2-基本信息修改" class="headerlink" title="5.2 基本信息修改"></a>5.2 基本信息修改</h4><p><strong>（1）基本信息介绍：</strong><br>Product Key ：<br>定义：产品标识码，开发者通过机智云后台创建新产品后，自动生成的一个32位字符串。在机智云的数据库中是一个唯一的号码，开发者将ProductKey写入设备主控MCU后，机智云通过此标识码对设备进行识别并自动完成注册。</p>
<p>Product Secret :<br>定义：产品密钥，在生成Productkey的时候云端会对应生成一个Product Secret，该参数为关键性机密参数，不应向第三方泄露。</p>
<p>版本号：用来区分不同版本代码。</p>
<p><strong>（2）获取项目基本信息</strong><br>在机智云开发者平台中打开项目，点击左侧基本信息，从中可获得本项目的Product Key和Product Secret(需要输入登录密码获得)；版本号由用户决定。</p>
<p><strong>（3）源码相应修改位置</strong><br>打开工程路径 Application\Common下文件gagent_iot_test_basic_connectivity.c 修改文件中的STR_PK和STR_PS相关参数，将从机智云平台获取的Product Key和Product Secret填入相应位置：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">#define STR_PK     &quot;plese replace your product PK&quot; </span><br><span class="line">                   //find it on your Gizwits Platform Project</span><br><span class="line">#define STR_PS    &quot;plese replace your product PS&quot; </span><br><span class="line">                   //find it on your Gizwits Platform Project</span><br><span class="line"></span><br><span class="line">程序提供了1byte用于版本号，版本号范围是1-255，程序中值是用十六进制表示的，所以填写时请按十六进制格式填写（01-FF）：</span><br><span class="line">#define GIZ_VER        &quot;01&quot; //is your project version,you can change it.</span><br></pre></td></tr></table></figure></p>
<h4 id="5-3-外设的驱动初始化代码添加"><a href="#5-3-外设的驱动初始化代码添加" class="headerlink" title="5.3 外设的驱动初始化代码添加"></a><strong>5.3 外设的驱动初始化代码添加</strong></h4><p>请在工程路径Application\Common下文件gagent_iot_test_basic_connectivity.c文件中<br>的userInit()函数中添加外设的驱动初始化相关代码</p>
<h4 id="5-4-云端下发数据处理"><a href="#5-4-云端下发数据处理" class="headerlink" title="5.4 云端下发数据处理"></a><strong>5.4 云端下发数据处理</strong></h4><p>（1）设备和云端通信协议<br>请在机智云开发者平台项目页面中点击开发向导，在MCU开发资源中下载《GizTest - 机智云WiFi类设备接入协议文档-SoC方案.pdf》</p>
<p>在文档中查看控制设备的相应指令协议格式，定义的数据点不同，生成的文档内容会不同，请以你生成的文档为准。</p>
<p>举例：例如收到的控制设备数据是：01 01 00<br>则action为01，是控制设备指令（不同指令action不同）<br>attr_flags为01，bit0为1，表示设置LED<br>attr_vals为00，bit0为0，表示设置LED的值为0，关闭LED</p>
<p>（2）源码相应修改位置<br>打开工程路径Application\Common下文件gagent_iot_test_basic_connectivity.c<br>在gizIssuedProcess ()函数中处理云端下发的数据，传入的数据格式跟协议中对应，请参照协议文档在函数中对action进行判断得到指令类型，然后进行相应处理。</p>
<h4 id="5-5-上报云端状态事件处理"><a href="#5-5-上报云端状态事件处理" class="headerlink" title="5.5 上报云端状态事件处理"></a><strong>5.5 上报云端状态事件处理</strong></h4><p><strong>（1）设备主动上报当前状态</strong></p>
<p>1)设备和云端通信协议</p>
<p>请在机智云开发者平台项目页面中点击开发向导，在MCU开发资源中下载《GizTest - 机智云WiFi类设备接入协议文档-SoC方案.pdf》,在文档中查看控制设备的相应指令协议格式，定义的数据点不同，生成的文档内容会不同，请以你生成的文档为准。</p>
<p>设备主动上报当前状态相关协议：</p>
<p>2）源代码修改位置</p>
<p>打开工程路径Application\Common下文件sensors_data.c，在PrepareMqttPayload ()函数中根据协议指令格式对当前状态的数据进行组包。</p>
<p>下图中按照前面的协议对数据进行了组包：</p>
<p>同时还需要根据组完包后PayloadBuffer数组的大小修改对应的初始化。</p>
<p>需要触发主动上报的情况：</p>
<ul>
<li>设备定时上报当前状态</li>
<li>设备状态发生变化时主动上报（包括云端下发控制指令后设备状态变化）</li>
</ul>
<p>a.设备定时上报代码相应修改位置：<br>打开工程路径Application\gagent_wrapper下文件ioftime.c，在timerEventHandler ()函数中可修改定时上报的周期，单位是ms<br>if(tick_count &gt;= 10000)   //修改后面的数值</p>
<p>b.设备状态发生变化时主动上报代码相应修改位置：<br>在需要触发主动上报的位置添加如下代码：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">if(osThreadIsSuspended(SensorThreadHandler) == osOK)</span><br><span class="line">&#123;</span><br><span class="line">osThreadResume(SensorThreadHandler);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p><strong>（2）收到读取设备当前状态的指令后上报当前状态</strong><br>1)设备和云端通信协议</p>
<p>请在机智云开发者平台项目页面中点击开发向导，在MCU开发资源中下载《GizTest - 机智云WiFi类设备接入协议文档-SoC方案.pdf》，在文档中查看控制设备的相应指令协议格式，定义的数据点不同，生成的文档内容会不同，请以你生成的文档为准。</p>
<p>读取设备当前状态相关协议：</p>
<p>2）源代码修改位置</p>
<p>打开工程路径Application\Common下文件gagent_iot_test_basic_connectivity.c，在gizIssuedProcess ()函数中需要对云端下发的数据进行判断，判断action是否为02，是则添加相应的代码触发数据上报：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">if(osThreadIsSuspended(SensorThreadHandler) == osOK)</span><br><span class="line">&#123;</span><br><span class="line">Device_Passive_Report = 1;</span><br><span class="line">osThreadResume(SensorThreadHandler);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h4 id="5-6-程序编译和加载"><a href="#5-6-程序编译和加载" class="headerlink" title="5.6 程序编译和加载"></a><strong>5.6 程序编译和加载</strong></h4><p><strong>（1）程序编译(下面以IAR Embedded Workbench for ARM为例)</strong><br>可选择菜单栏 ProjectMake ，或者点击工具栏对应图标开始编译</p>
<p><strong>（2）程序加载</strong><br>1）程序编译完成后，在路径<br>Gizwits_V1.1.1_Lib\Projects\B-L475E-IOT01\Applications\Cloud\Gizwits\EWARM \B-L475E-IOT01\Exe下会生成 Project.bin 文件，复制该文件；</p>
<p> 2）将Micro USB线插入开发板的USB STLINK接口（如图），另一端连接电脑。</p>
<p>插入电脑后，在我的电脑会出现一个名为DIS_L4IOT的盘，进入DIS_L4IOT，将前面复制的Project.bin文件粘贴到里面，复制完成后会自动退出DIS_L4IOT盘，表示文件加载完成。</p>
<h4 id="5-7-WIFI信息配置"><a href="#5-7-WIFI信息配置" class="headerlink" title="5.7 WIFI信息配置"></a><strong>5.7 WIFI信息配置</strong></h4><p><strong>（1）设置波特率</strong><br>使用串口工具（可以用SecureCRT）打开设备串口（串口号在设备管理器中查看），波特率为115200</p>
<p><strong>（2）进入WIFI信息配置模式方式：</strong><br>1）按下开发板上的RESET按键，如果没有配置过WIFI信息，则自动进入配置模式<br>2）按下开发板上的RESET按键，如果配置过WIFI信息，则在按下RESET按键后的5s内按下开发板上的USER按键进入配置模式</p>
<p><strong>（3）信息配置</strong><br>进入配置模式后开发板会打印如下信息</p>
<p>1）输入： y ，会请求输入SSID（WIFI名称）</p>
<p>2）输入SSID，按回车键（注意：这里输入SSID的时候是没有显示的，输入完成回车后才会显示SSID信息）</p>
<p>3）输入WIFI模式，根据路由器的配置来选择，如果WIFI没有密码，则输入0，如果WIFI有密码但不知道是哪一种模式，则输入3（如果后面无法连接上则要去查看路由器的配置）</p>
<p>4)输入WIFI密码，按回车键，WIFI信息配置完成，开发板会尝试连接WIFI</p>
<p>5）如果连接上WIFI，开发板会正常运行打印其它信息，如果无法连接上WIFI，请检查输入的WIFI信息是否有错误</p>
<h4 id="5-8-上线情况以及日志查看"><a href="#5-8-上线情况以及日志查看" class="headerlink" title="5.8 上线情况以及日志查看"></a><strong>5.8 上线情况以及日志查看</strong></h4><p>设备运行后，可在机智云开发者平台对应项目中设备日志中查看，点击查看可浏览通信日志、上下线记录、运行记录</p>
<h4 id="5-9-APP控制设备"><a href="#5-9-APP控制设备" class="headerlink" title="5.9 APP控制设备"></a><strong>5.9 APP控制设备</strong></h4><p>从机智云下载中心下载机智云串口调试助手绑定设备</p>
<p> 打开机智云串口调试助手，点击下方“小工具”，然后选择上方的”二维码生成”，输入项目的Product Key和设备的MAC，点击“获取二维码”。</p>
<p> 从下载中心下载机智云调试APP，安装，打开APP</p>
<p> 点击左上角“我的设备”，扫描生成的二维码，扫描完成列表会显示相应的设备，点击设备就可以进入设备控制界面</p>
<h3 id="6-OTA升级流程"><a href="#6-OTA升级流程" class="headerlink" title="6. OTA升级流程"></a><strong>6. OTA升级流程</strong></h3><h4 id="6-1-生成OTA升级固件"><a href="#6-1-生成OTA升级固件" class="headerlink" title="6.1 生成OTA升级固件"></a>6.1 生成OTA升级固件</h4><p>请将新版本程序编译（记得修改版本号，修改方式请查看前文，需大于待升级设备的版本号），生成Project.bin文件（以IAR Embedded Workbench for ARM为例，文件在Gizwits_V1.1.1_Lib\Projects\B-L475E-IOT01\Applications\Cloud\Gizwits\EWARM \B-L475E-IOT01\Exe目录下）</p>
<h4 id="6-2-固件命名规则"><a href="#6-2-固件命名规则" class="headerlink" title="6.2 固件命名规则"></a>6.2 固件命名规则</h4><p>GAgent命名是有固定标准的，名称由GAgent、硬件版本名称、软件版本、发布日期、特殊标记信息三部分组成。</p>
<p>举例：<br>GAgent_00BL01A2_04030002_18090510.bin<br>GAgent：固定的字段，不用修改;<br>00BL01A2：硬件版本名称，B-L475E-IOT01A2开发板统一使用00BL01A2，不用修改;<br>04030002：软件版本，用户需要根据程序中的版本号修改最后两位，前面040300不用修改;<br>18090510：发布日期，18年09月05日10点，用户根据实际时间修改;</p>
<p>如果需要对估计做特殊标记，可以添加在最后，举例：<br>GAgent_00BL01A2_04030002_18090510_UART.bin<br>请用户对Project.bin文件按命名规则修改名称</p>
<h4 id="6-3-上传固件到开发者平台"><a href="#6-3-上传固件到开发者平台" class="headerlink" title="6.3 上传固件到开发者平台"></a>6.3 上传固件到开发者平台</h4><p>登录机智云开发者平台，进入对应项目，点击左侧“固件升级(OTA)”，然后点击中间的创建新固件</p>
<p>填写固件信息，下图中的版本名称用户可以自定，可以方便用户区别不同版本就行，硬件版本号和软件版本号按实际填写，其它信息按默认的就行，然后上传固件，然后点击“完成 ”。如果想了解关于固件升级的一些事项，可以点击下图中右上角的“查看固件升级FAQ”</p>
<p>完成固件上传和信息填写后，会进入固件验证界面，请用户核对固件信息是否填写有误，如需修改或删除，可以点击右侧选项，核对信息无误后，需进行固件验证。（需使用一台设备用户固件验证，设备要能够正常上线）</p>
<p>点击“验证固件”，会出现如下界面，请填写用于验证的设备对应的MAC地址（可在设备日志中查看，如果填写错误会导致最后验证失败），然后点击“推送”。</p>
<p>进入验证固件界面，请用户耐心等待。</p>
<p>如果固件验证成功，会出现如下界面，请打勾后点击“完成”</p>
<p>如果固件验证失败，会出现如下界面</p>
<p>固件验证成功后，可以进行正式推送，推送前需要设置推送的规则</p>
<p>推送可按指定地区推送或指定MAC推送，设置好推送方式后，请设置推送的周期，然后点击“保存”</p>
<p>保存后在相应的规则会出现在固件推送页面下方，点击“开始推送”，开始推送固件给指定的地区或指定的MAC</p>
<p>如果需要在推送过程中停止推送，请点击“停止推送”<br>可以点击“手动刷新”来查看目前已推送成功的设备数量</p>
<h1 id="FAQ"><a href="#FAQ" class="headerlink" title="FAQ"></a>FAQ</h1><p><strong>问题：加载新的程序，上电后运行的还是之前的程序</strong><br>解决步骤：<br>（1）下载安装STM32 ST-LINK Utility软件<br>（2）将开发板用Micro USB线接入电脑，点击下图红框中的图标，连接设备<br>（3）点击菜单栏 Target Option Bytes，打开Option Bytes设置页面，查看BFB2一项后面是否有打勾，如果有打勾，则把勾去掉，然后点击 Apply。<br>（4）点击下图红框中的图标，断开STM32 ST-LINK Utility软件与设备的连接，然后重启开发板</p>

    </div>
    
    <div class="widget-wrapper">
  <span class="widget">
    <div>
        <a id='share' target="_blank" title="Share">
          <span>Share</span>
        </a>
        <div class="social-share" data-initialized="true">
            <a href="#" class="social-share-icon icon-wechat"></a>
            <a href="#" class="social-share-icon icon-weibo"></a>
            <a href="#" class="social-share-icon icon-qq"></a>
            <a href="#" class="social-share-icon icon-qzone"></a>
            <a href="#" class="social-share-icon icon-douban"></a>
        </div>
    </div>
    <a href="http://y0.cn/docs" target="_blank" title="Register">
      <span>Register</span>
    </a>
    <a href="https://github.com/gizwits-docs/gizwits-docs/issues" target="_blank" title="Feed back">
      <span>Feed back</span>
    </a>
    <a href="#" title="Top"><i class="fa fa-angle-up fa-2x" aria-hidden="true"></i></a>
  </span>
</div>
  </div>
</div>

    <div class="footer">
  <div class="container">
    <p>
      <span><a href="http://www.gizwits.com" target="_blank">HOME</a></span>
      <span><a href="http://www.gizwits.com/about-us" target="_blank">ABOUT</a></span>
      <span><a href="http://www.gizwits.com/about-us#contact-us" target="_blank">CONTACT</a></span>
      <span><a href="http://www.gizwits.com/join-us" target="_blank">JOIN</a></span>
    </p>
    <p>&#169;2011-2017; Gizwits IoT Technology Co., Ltd. 粤ICP备11090211号</p>
  </div>
</div>

    <script src="/js/spin.min.js"></script>
<script src="/js/jquery.min.js"></script>
<script src="/js/jquery.hashchange.min.js"></script>
<script src="/js/clipboard.min.js"></script>
<script src="/js/scrollspy.js"></script>
<script src="/js/social-share.min.js"></script>
<script src="/js/documentation.js?v=d413cf8ceca4865c39c2dabcd3bc0077"></script>


<script type="text/javascript" src="http://webchat.7moor.com/javascripts/7moorInit.js?accessId=b01e0430-943a-11e6-8ad7-636675d9e71f&autoShow=true" async='async'></script>


<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?3787e6b3b29a084fde41f22828d89b7d";
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(hm, s);
})();
</script>
  </body>
</html>