
<!DOCTYPE html>
<html lang="zh-cn">
  <head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="utf-8">

  <title>微信应用开发教程 - 机智云</title>

  <meta http-equiv="X-UA-Compatible" content="IE=Edge, chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <meta name="Description" content="微信应用开发教程-机智云">
  <meta name="keywords" content="微信应用开发教程 docs 文档中心 Gizwits">

  <link rel="shortcut icon" href="/images/favicon.png" type="image/x-icon">
  <script src="/js/redirect.js"></script>

  <link rel="stylesheet" href="/css/pure.min.css">
  <link rel="stylesheet" href="/css/font-awesome.min.css">
  <link rel="stylesheet" href="/css/documentation.css?v=db6111caa3d210b6cb1d2dac5119d7c5">
  <link rel="stylesheet" href="/css/share.min.css">
</head>
  <body>
    <div class="header">
  <div class="container pure-g">
    <span class="brand pure-u-5-24">
      <a href="http://www.gizwits.com" class="logo">
      
      <img src="/images/logo.png" alt="logo">
      
      </a>
      <a class="text" href="/">文档中心</a>
    </span>

    <div class="mobile-header" v="">
      <span class="title">机智云 文档中心</span>
      <i class="fa fa-caret-square-o-down fa-lg" aria-hidden="true"></i>
    </div>

    <span class="menu pure-u-16-24">
      <span class="header-search-btn" id="header-search-btn">
        <i class="fa fa-search"></i>
      </span>
      <ul class="levelA-wrapper">
        
          
            <li class="levelA"><a href="/zh-cn/overview/overview.html">平台概述</a></li>
          
        
          
            <li class="levelA">
              快速入门 &#9662;
              <ul class="levelB-wrapper">
                
                  
                    <li class="levelB"><a href="/zh-cn/quickstart/5分钟了解机智云.html">5分钟了解机智云</a></li>
                  
                
                  
                    <li class="levelB"><a href="/zh-cn/quickstart/noun.html">机智云名词定义解释</a></li>
                  
                
              </ul>
            </li>
          
        
          
            <li class="levelA">
              应用开发 &#9662;
              <ul class="levelB-wrapper">
                
                  
                    <li class="levelB"><a href="/zh-cn/quickstart/准备工作.html">App开发准备工作及向导</a></li>
                  
                
                  
                    <li class="levelB"><a href="/zh-cn/UserManual/devApp.html">App代码自动生成服务介绍</a></li>
                  
                
                  
                    <li class="levelB has-submenu">
                      App 开源框架 &#9656;
                      <ul class="levelC-wrapper">
                        
                          <li class="levelC"><a href="/zh-cn/AppDev/iosframe.html">iOS 开源框架说明(含源码)</a></li>
                        
                          <li class="levelC"><a href="/zh-cn/AppDev/iOS消息推送.html">iOS 消息推送</a></li>
                        
                          <li class="levelC"><a href="/zh-cn/AppDev/iOS第三方登陆与换肤.html">iOS 第三方登录与换肤</a></li>
                        
                          <li class="levelC"><a href="/zh-cn/quickstart/iOSAPPFrame.html">iOS开源框架的快速开发实例</a></li>
                        
                          <li class="levelC"><a href="/zh-cn/AppDev/Android开源框架使用指南.html">Android 开源框架说明（含源码）</a></li>
                        
                          <li class="levelC"><a href="/zh-cn/AppDev/Android消息推送.html">Android 消息推送</a></li>
                        
                          <li class="levelC"><a href="/zh-cn/AppDev/Android第三方登录与换肤.html">Android 第三方登录与换肤</a></li>
                        
                          <li class="levelC"><a href="/zh-cn/quickstart/AndroidAppFrame.html">Android开源框架的快速开发实例</a></li>
                        
                          <li class="levelC"><a href="/zh-cn/AppDev/APICloudFrame.html">APICloud开源框架使用指南(含源码)</a></li>
                        
                          <li class="levelC"><a href="/zh-cn/AppDev/开源框架视频教程.html">开源框架使用视频教程</a></li>
                        
                      </ul>
                    </li>
                  
                
                  
                    <li class="levelB has-submenu">
                      App 开发 SDK &#9656;
                      <ul class="levelC-wrapper">
                        
                          <li class="levelC"><a href="/zh-cn/AppDev/iOSSDKA2.html">iOS SDK</a></li>
                        
                          <li class="levelC"><a href="/zh-cn/AppDev/AndroidSDKA2.html">Android SDK</a></li>
                        
                          <li class="levelC"><a href="/zh-cn/AppDev/APICloudWifiSDK.html">APICloud SDK</a></li>
                        
                          <li class="levelC"><a href="/zh-cn/AppDev/SDK数据透传方法解析.html">SDK数据透传方法解析</a></li>
                        
                          <li class="levelC"><a href="/zh-cn/AppDev/SDK调试日志抓取教程.html">SDK调试日志抓取教程</a></li>
                        
                          <li class="levelC"><a href="/zh-cn/AppDev/sdk_error.html">SDK错误码列表</a></li>
                        
                      </ul>
                    </li>
                  
                
                  
                    <li class="levelB"><a href="/zh-cn/WechatDev/了解微信应用开发.html">了解微信应用开发</a></li>
                  
                
                  
                    <li class="levelB"><a href="/zh-cn/WechatDev/WeChatDev.html">微信应用开发教程</a></li>
                  
                
                  
                    <li class="levelB has-submenu">
                      更多教程 &#9656;
                      <ul class="levelC-wrapper">
                        
                          <li class="levelC"><a href="/zh-cn/Cloud/SharingSDK.html">设备分享功能SDK使用流程</a></li>
                        
                          <li class="levelC"><a href="/zh-cn/AppDev/third-party.html">第三方登录平台申请流程</a></li>
                        
                      </ul>
                    </li>
                  
                
                  
                    <li class="levelB"><a href="/zh-cn/AppDev/应用开发FAQ.html">应用开发FAQ</a></li>
                  
                
              </ul>
            </li>
          
        
          
            <li class="levelA">
              设备接入 &#9662;
              <ul class="levelB-wrapper">
                
                  
                    <li class="levelB"><a href="/zh-cn/deviceDev/设备接入准备工作及向导.html">设备接入准备工作及向导</a></li>
                  
                
                  
                    <li class="levelB has-submenu">
                      设备快速接入机智云 &#9656;
                      <ul class="levelC-wrapper">
                        
                          <li class="levelC"><a href="/zh-cn/quickstart/UseMCU.html">独立MCU接入方案</a></li>
                        
                          <li class="levelC"><a href="/zh-cn/deviceDev/UseSOC.html">ESP8266-SOC接入方案</a></li>
                        
                      </ul>
                    </li>
                  
                
                  
                    <li class="levelB"><a href="/zh-cn/module_source/module_source.html">模块硬件资料</a></li>
                  
                
                  
                    <li class="levelB has-submenu">
                      GAgent通讯模组使用教程 &#9656;
                      <ul class="levelC-wrapper">
                        
                          <li class="levelC"><a href="/zh-cn/deviceDev/gagent_info.html">GAgent详细介绍</a></li>
                        
                          <li class="levelC"><a href="/zh-cn/deviceDev/串口工具使用文档.html">串口工具使用文档</a></li>
                        
                          <li class="levelC"><a href="/zh-cn/deviceDev/HF-LPB100串口烧写说明.html">HF-LPB100串口烧写说明</a></li>
                        
                          <li class="levelC"><a href="/zh-cn/deviceDev/debug/HF-LPT120.html">HF-LPT120串口烧写说明</a></li>
                        
                          <li class="levelC"><a href="/zh-cn/deviceDev/debug/HF-LPT230.html">HF-LPT230串口烧写说明</a></li>
                        
                          <li class="levelC"><a href="/zh-cn/deviceDev/MXCHIP串口烧写说明.html">MXCHIP串口烧写说明</a></li>
                        
                          <li class="levelC"><a href="/zh-cn/deviceDev/ESP8266串口烧写说明.html">ESP8266串口烧写说明</a></li>
                        
                          <li class="levelC"><a href="/zh-cn/deviceDev/debug/G510.html">广和通G510模组烧写方法</a></li>
                        
                          <li class="levelC"><a href="/zh-cn/deviceDev/通讯模组调试日志抓取教程.html">通讯模组调试日志抓取教程</a></li>
                        
                      </ul>
                    </li>
                  
                
                  
                    <li class="levelB has-submenu">
                      MCU代码自动生成服务介绍 &#9656;
                      <ul class="levelC-wrapper">
                        
                          <li class="levelC"><a href="/zh-cn/deviceDev/DevSDK/代码自动生成工具.html">MCU代码自动生成工具使用教程</a></li>
                        
                          <li class="levelC"><a href="/zh-cn/deviceDev/GoKit3_DEV_SDK_Common_transplant.html">MCU SDK 通用平台移植教程</a></li>
                        
                          <li class="levelC"><a href="/zh-cn/deviceDev/STM32CubeMX_transplant.html">STM32CubeMX移植机智云自动生成代码详解</a></li>
                        
                          <li class="levelC"><a href="/zh-cn/deviceDev/approach_to_tailoring_8051.html">8051平台最小资源裁剪说明</a></li>
                        
                      </ul>
                    </li>
                  
                
                  
                    <li class="levelB has-submenu">
                      开源套件Gokit资料 &#9656;
                      <ul class="levelC-wrapper">
                        
                          <li class="levelC"><a href="/zh-cn/deviceDev/Gokit2使用指南.html">Gokit2 使用指南</a></li>
                        
                          <li class="levelC"><a href="/zh-cn/deviceDev/Gokit3/Gokit3开发套件简介.html">Gokit3系列开发套件简介</a></li>
                        
                          <li class="levelC"><a href="/zh-cn/deviceDev/Gokit3/GoKit3硬件手册.html">Gokit3硬件手册</a></li>
                        
                          <li class="levelC"><a href="/zh-cn/deviceDev/WiFiSOC/GoKit3S使用说明书.html">GoKit3(S)使用说明书</a></li>
                        
                          <li class="levelC"><a href="/zh-cn/deviceDev/WiFiSOC/GoKit3S开发套件介绍.html">Gokit3(S)开发套件介绍</a></li>
                        
                          <li class="levelC"><a href="/zh-cn/deviceDev/WiFiSOC/GoKit3S二次开发.html">GoKit3(S)开发环境搭建</a></li>
                        
                          <li class="levelC"><a href="/zh-cn/deviceDev/WiFiSOC/GoKit-SoC-explanation.html">GoKit-SoC程序详解</a></li>
                        
                          <li class="levelC"><a href="/zh-cn/deviceDev/Gokit3Voice/GoKit-MCU-explanation.html">GoKit-MCU程序详解</a></li>
                        
                          <li class="levelC"><a href="/zh-cn/deviceDev/Gokit4/Gokit4_Dev_Assets.html">Gokit4(G) SoC开发环境搭建、开发指南</a></li>
                        
                      </ul>
                    </li>
                  
                
                  
                    <li class="levelB has-submenu">
                      开发套件Arduino资料 &#9656;
                      <ul class="levelC-wrapper">
                        
                          <li class="levelC"><a href="/zh-cn/deviceDev/ArduinoUNO/ArduinoUNOWiFi_intro.html">ArduinoUNOWiFi接入机智云介绍</a></li>
                        
                          <li class="levelC"><a href="/zh-cn/deviceDev/ArduinoUNO/Tutorial.html">ArduinoUnoWiFi 之ESP8266固件烧写教程</a></li>
                        
                          <li class="levelC"><a href="/zh-cn/deviceDev/ArduinoUNO/ArduinoUnoWiFi_SDK_API.html">ArduinoUnoWiFi SDK之API介绍</a></li>
                        
                          <li class="levelC"><a href="/zh-cn/deviceDev/ArduinoUNO/example.html">Arduino Uno WiFi智能小夜灯</a></li>
                        
                      </ul>
                    </li>
                  
                
                  
                    <li class="levelB has-submenu">
                      更多接入指南 &#9656;
                      <ul class="levelC-wrapper">
                        
                          <li class="levelC"><a href="/zh-cn/UserManual/ecevideos.html">ECE Demo开发教程</a></li>
                        
                          <li class="levelC"><a href="/zh-cn/deviceDev/串口工具使用文档.html">串口工具使用文档</a></li>
                        
                          <li class="levelC"><a href="/zh-cn/deviceDev/STICubeGizwits/STICubeGizwits.html">ST I-CUBE-GizWits套件快速接入指南</a></li>
                        
                      </ul>
                    </li>
                  
                
                  
                    <li class="levelB"><a href="/zh-cn/deviceDev/设备接入FAQ.html">设备接入FAQ</a></li>
                  
                
              </ul>
            </li>
          
        
          
            <li class="levelA">
              云API &#9662;
              <ul class="levelB-wrapper">
                
                  
                    <li class="levelB"><a href="/zh-cn/Cloud/openapi_apps.html">Open API 指南</a></li>
                  
                
                  
                    <li class="levelB"><a href="/zh-cn/Cloud/ent_dev.html">企业应用开发</a></li>
                  
                
                  
                    <li class="levelB"><a href="/zh-cn/Cloud/enterprise_api.html">企业API</a></li>
                  
                
                  
                    <li class="levelB"><a href="/zh-cn/Cloud/NotificationAPI.html">SNoti API</a></li>
                  
                
                  
                    <li class="levelB"><a href="/zh-cn/Cloud/WebsocketAPI.html">WebSocketAPI</a></li>
                  
                
                  
                    <li class="levelB has-submenu">
                      API使用教程 &#9656;
                      <ul class="levelC-wrapper">
                        
                          <li class="levelC"><a href="/zh-cn/UserManual/UseOpenAPI.html">使用OpenAPI控制虚拟设备教程</a></li>
                        
                          <li class="levelC"><a href="/zh-cn/UserManual/UseSNoti.html">Snoti数据实时同步服务demo使用教程</a></li>
                        
                          <li class="levelC"><a href="/zh-cn/UserManual/UseWebsocket.html">使用Websocket 网页控制设备教程</a></li>
                        
                          <li class="levelC"><a href="/zh-cn/UserManual/DataAPI.html">使用聚合API教程</a></li>
                        
                          <li class="levelC"><a href="/zh-cn/UserManual/LinkageAPI.html">设备联动API使用教程</a></li>
                        
                          <li class="levelC"><a href="/zh-cn/UserManual/devgroup_API.html">设备分组API使用教程</a></li>
                        
                          <li class="levelC"><a href="/zh-cn/UserManual/UseQRCode.html">APP绑定设备二维码生成教程</a></li>
                        
                      </ul>
                    </li>
                  
                
                  
                    <li class="levelB"><a href="/zh-cn/Cloud/CloudFAQ.html">云端应用FAQ</a></li>
                  
                
              </ul>
            </li>
          
        
          
            <li class="levelA">
              用户手册 &#9662;
              <ul class="levelB-wrapper">
                
                  
                    <li class="levelB"><a href="/zh-cn/UserManual/change.html">个人项目产品转企业项目产品</a></li>
                  
                
                  
                    <li class="levelB has-submenu">
                      OTA使用教程 &#9656;
                      <ul class="levelC-wrapper">
                        
                          <li class="levelC"><a href="/zh-cn/UserManual/OTA.html">GAgent OTA教程</a></li>
                        
                          <li class="levelC"><a href="/zh-cn/UserManual/MCUOTA.html">MCU OTA教程</a></li>
                        
                      </ul>
                    </li>
                  
                
                  
                    <li class="levelB"><a href="/zh-cn/deviceDev/产测工具使用文档.html">产测工具使用文档</a></li>
                  
                
                  
                    <li class="levelB"><a href="/zh-cn/UserManual/D3.html">D3 Engine使用教程</a></li>
                  
                
                  
                    <li class="levelB"><a href="/zh-cn/UserManual/ece.html">ECE雾计算使用教程</a></li>
                  
                
                  
                    <li class="levelB has-submenu">
                      语音音箱接入教程 &#9656;
                      <ul class="levelC-wrapper">
                        
                          <li class="levelC"><a href="/zh-cn/UserManual/echo.html">接入Echo开发教程</a></li>
                        
                          <li class="levelC"><a href="/zh-cn/deviceDev/echo.html">使用Echo音箱控制GoKit</a></li>
                        
                          <li class="levelC"><a href="/zh-cn/UserManual/Google_Home_GoKit.html">使用Google Home音箱控制GoKit</a></li>
                        
                      </ul>
                    </li>
                  
                
                  
                    <li class="levelB"><a href="/zh-cn/UserManual/rtbd.html">实时大数据使用教程</a></li>
                  
                
                  
                    <li class="levelB"><a href="/zh-cn/UserManual/WorldWideConnectSolution.html">全球部署方案</a></li>
                  
                
              </ul>
            </li>
          
        
      </ul>
    </span>

    <span class="pure-u-3-24 lang-switch-wrapper">

      <i class="fa fa-globe" aria-hidden="true"></i>
      
      <a href="/en-us/overview/overview.html" class="lang-switch">English</a>
      
    </span>
  </div>

  <div class="header-search-panel" id="header-search-panel">
    <span class="header-search-close" id="header-search-close"><i class="fa fa-times" aria-hidden="true"></i></span>
    <div class="header-search-input-wrap" id="header-search-input-wrap">
      <input type="text" class="header-search-input" id="header-search-input" placeholder="请输入关键字">
      <span class="header-search-input-icon"><i class="fa fa-search"></i></span>
    </div>

    <div class="header-search-trend" id="header-search-trend">
      <div class="header-search-trend-title">热搜词</div>
      <div class="header-search-trend-items clearfix">
        
        <div class="header-search-trend-item" data-word="APP">APP</div>
        
        <div class="header-search-trend-item" data-word="SDK">SDK</div>
        
        <div class="header-search-trend-item" data-word="Android">Android</div>
        
        <div class="header-search-trend-item" data-word="ios">ios</div>
        
        <div class="header-search-trend-item" data-word="WIFI">WIFI</div>
        
      </div>
    </div>

    <div class="header-search-result hidden" id="header-search-result">
      <div class="header-search-result-head">
        搜索结果 &gt; <span id="header-search-keyword"></span>
      </div>
      <div class="header-search-result-items" id="header-search-result-items">
      </div>
    </div>
  </div>
</div>

    <div class="body">

  <div class="container clearfix">
    <div class="navigation">
      <div class="navigation-inner">
        <div class="nav-title">目录</div>
        <div class="nav"></div>
      </div>
    </div>
    <div class="markdown-body" data-spy="scroll" data-target=".navigation">
      <div class="heading">
        <div class="title">微信应用开发教程</div>
        <a class="edit-link" target="_blank"><i class="fa fa-github" aria-hidden="true"></i> 文档编辑</a>
      </div>
      <h1 id="微信SDK"><a href="#微信SDK" class="headerlink" title="微信SDK"></a>微信SDK</h1><p>附件：<a href="https://github.com/gizwits/gizwits-wechat-js-sdk" target="_blank" rel="noopener">微信SDK包下载</a></p>
<h1 id="目标驱动的教程"><a href="#目标驱动的教程" class="headerlink" title="目标驱动的教程"></a>目标驱动的教程</h1><p>本教程以目标为驱动，去除多余的细节，让机智云的小伙伴们，可以快速的搞定微信接入。好啦，我们开始吧！</p>
<h1 id="为什么接入微信？"><a href="#为什么接入微信？" class="headerlink" title="为什么接入微信？"></a>为什么接入微信？</h1><ul>
<li><p>微信有大量的用户</p>
</li>
<li><p>用户不愿意，为某个垂直领域的服务，单独装一个应用</p>
</li>
<li><p>微信有全平台的版本，开发一次，相当于开发多个应用</p>
</li>
</ul>
<p>等等……</p>
<p>正是这些好处，我们才会借助微信的力量。所以，我们将借助微信的两大体系: </p>
<ul>
<li><p>用户体系（OpenId）</p>
</li>
<li><p>微信APP（AirKiss 和 内置浏览器）。</p>
</li>
</ul>
<p>最终，我们希望用户，能像体验微信原生功能一样，使用我们的智能设备。</p>
<h1 id="你有微信公众号"><a href="#你有微信公众号" class="headerlink" title="你有微信公众号?"></a>你有微信公众号?</h1><p>首先，我们需要申请微信公众号。</p>
<p>注意，不能申请订阅号（不支持微信认证）。我们将申请一个服务号，并且完成认证操作，然后才能开启“设备功能”模块，最后添加一个产品。</p>
<p>最终，你会得到两件装备：</p>
<ul>
<li><p>公众号的原始ID</p>
</li>
<li><p>设备的二维码</p>
</li>
</ul>
<p>当然，你也可以使用测试号，进行前期开发阶段的调试。</p>
<h1 id="你得有台设备吧？"><a href="#你得有台设备吧？" class="headerlink" title="你得有台设备吧？"></a>你得有台设备吧？</h1><p>微信接入前，需保证，设备能正常地与机智云进行通讯，设备的具体开发流程如下。</p>
<p><img src="/assets/zh-cn/WechatDev/wechat_02.png" alt="Alt text"></p>
<p> 注意，在WIFI模块中，写入AirKiss时，需要配置公众号的原始ID。也就说，除了将机智云的product_key写入MCU以外，还需要将公众号原始ID写入WIFI固件中。关于固件的烧录，厂商或者小伙伴们如有困难，可以寻求机智云 · 客服MM的帮助。</p>
<h1 id="设备二维码"><a href="#设备二维码" class="headerlink" title="设备二维码"></a>设备二维码</h1><p>微信客户端APP可以通过扫描二维码添加设备。为使已成功接入机智云的设备能被微信控制，在微信公众平台创建产品的时候请按照以下设置来勾选。设置内容如下：</p>
<p><img src="/assets/zh-cn/WechatDev/wechat_03.png" alt="Alt text"></p>
<p>其中：连接类型选择“Wi-Fi”设备；</p>
<p>产品添加方式选择“每种型号唯一的二维码”，产品添加成功后，微信会生成此款产品的唯一一个二维码，通过扫描这个唯一的二维码可以进行微信配网后近场发现设备来绑定，如果选择“每个产品唯一的二维码”，那么将会为此款产品的每一个产品生成一个二维码，扫描该二维码可以直接绑定设备，但是无法通过近场发现绑定；</p>
<p>产品配置方式选择“微信配网”与“不使用加密”。</p>
<h1 id="设备授权"><a href="#设备授权" class="headerlink" title="设备授权"></a>设备授权</h1><p>设备不但要在WIFI固件中写入公众号原始ID(注意，不是APPID)，还要将所有设备的Mac地址，登记到微信服务器上。一开始，微信只给你100个配额，也就是说，你只能授权100个设备。</p>
<p>授权的方法，就是向微信的接口，发送一次请求，具体请看微信文档-设备授权。</p>
<p>很多小伙伴反应，授权经常失败，我们这里给出一组基于WIFI通讯的示例，大家可以参考：</p>
<p><img src="/assets/zh-cn/WechatDev/wechat_04.png" alt="Alt text"></p>
<p> 注意：12位xxxxxxxxxxxx，代表设备的Mac地址，id是指设备ID，也就是机智云的did。但因为设备必须在上线后，机智云才会分配一个did，所以，我们并无法预知did是什么。通常的做法是：将id和mac，都设置为设备的Mac值。</p>
<p>auth_key可以不填，设置为空字符串，但不能没有这个字段。</p>
<p>op_type为0时，表示添加一台设备，后面需要跟着product_id字段(产品ID，在公众号的“设备功能”中，添加产品后，会有这个id)。op_type为1时，表示更新一台设备，此时不需要product_id字段。</p>
<p>批量授权时，记得更新顶部的：device_num。</p>
<p>这样，我们硬件（设备）层面的准备工作，就完成啦。</p>
<h1 id="阶段性成果"><a href="#阶段性成果" class="headerlink" title="阶段性成果"></a>阶段性成果</h1><p>好了，到这步，你可以稍微的奖励一下自己，享受一下阶段性的成果啦! </p>
<p>打开你的微信（确保是wifi链接状态），扫一扫你的产品二维码。</p>
<p><img src="/assets/zh-cn/WechatDev/wechat_05.jpg" alt="Alt text"></p>
<p>下面有两个按钮，绿色的按钮，是启动微信的AirKiss，将WIFI的账号密码，发送给设备的WIFI模块。</p>
<p>部分设备需要启动匹配模式，才能配置上网。一般先启动设备的匹配模式，再使用微信的配置功能。配置完成后，会自动跳转到设备搜索界面。</p>
<p>在搜索界面，如果前面准备工作到位了，你一定能发现设备（不管是否绑定过）。点击发现的设备，然后绑定。微信会自动跳转到公众号页面。然后，你可以在微信的设置页面中，发现多了一个项目：设备。</p>
<p>当然，上面的操作，只是实现绑定操作。下面的教程将介绍如何监控设备的数据点。</p>
<h1 id="简化操作的SDK"><a href="#简化操作的SDK" class="headerlink" title="简化操作的SDK"></a>简化操作的SDK</h1><p>为了简化开发者的操作，我们将一些必要的API封装成了两个SDK: java-SDK 以及 js-SDK。它们分别用于后台和前端页面，各自封装了机智云的OpenAPI 以及 WebSocket。</p>
<p>这两个SDK，将大大的简化了API的操作，帮我们接管了token和用户管理，我们只需要调用相关方法，即可实现设备的绑定和解绑。</p>
<p>SDK，可以在本文的附件中下载。</p>
<h1 id="业务服务器的搭建"><a href="#业务服务器的搭建" class="headerlink" title="业务服务器的搭建"></a>业务服务器的搭建</h1><p>设备没问题了，我们现在需要的是，操控设备本身的功能。</p>
<p>由于设备已经与机智云正常的通讯，因此，对设备的操作，其实就是如何与机智云交互。</p>
<h1 id="机智云设备绑定"><a href="#机智云设备绑定" class="headerlink" title="机智云设备绑定"></a>机智云设备绑定</h1><p>现在，用户已经在微信中绑定了设备，他希望看到，设备在线状态。怎么办?</p>
<p>我们使用微信的OpenId，作为唯一标识，生成匿名用户。什么时候注册匿名用户呢？微信绑定设备时候，将推送一条设备绑定事件消息到我们的业务服务器。我们在这个时候，将同时完成注册匿名用户，以及绑定用户/设备的操作。</p>
<p><img src="/assets/zh-cn/WechatDev/wechat_06.jpg" alt="Alt text"></p>
<p>微信在绑定时，发送这么一条事件消息：</p>
<p><img src="/assets/zh-cn/WechatDev/wechat_6.5.png" alt="Alt text"></p>
<p>我们需要的是其中的OpenID和Mac，然后我们调用机智云的Java-SDK：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">DeviceInfo deviceInfo = OpenApi.bindDevice(</span><br><span class="line">                                    wechatOpenId, </span><br><span class="line">                                    gizwitsAppId, </span><br><span class="line">                                    gizwitsProductKey, </span><br><span class="line">                                    gizwitsProductSecret, </span><br><span class="line">                                    mac, </span><br><span class="line">                                    deviceAlias, </span><br><span class="line">                                    deviceRemark)</span><br></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th>参数名</th>
<th style="text-align:center">类型</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>wechatOpenId</td>
<td style="text-align:center">String</td>
<td>微信中的OpenId，也就是机智云中注册的匿名用户</td>
</tr>
<tr>
<td>gizwitsAppId</td>
<td style="text-align:center">String</td>
<td>机智云产品所绑定的APP的id</td>
</tr>
<tr>
<td>gizwitsProductKey</td>
<td style="text-align:center">String</td>
<td>机智云的产品key</td>
</tr>
<tr>
<td>gizwitsProductSecret</td>
<td style="text-align:center">String</td>
<td>机智云的产品Secret</td>
</tr>
<tr>
<td>mac</td>
<td style="text-align:center">String</td>
<td>设备的Mac地址</td>
</tr>
<tr>
<td>deviceAlias</td>
<td style="text-align:center">String</td>
<td>设备的别名</td>
</tr>
<tr>
<td>deviceRemark</td>
<td style="text-align:center">String</td>
<td>设备的备注</td>
</tr>
</tbody>
</table>
<p> 这个方法，一次性解决了两个问题：注册匿名用户，绑定用户/设备。相对的，也要设定很多参数。所有的参数都是String类型。</p>
<p>其中deviceAlias（设备别名）以及deviceRemark（设备备注）都可以填空字符串“”。gizwitsProductKey就是你在开发者中心创建的产品。</p>
<p><img src="/assets/zh-cn/WechatDev/wechat_07.jpg" alt="Alt text"></p>
<p>而gizwitsProductSecret，则是该产品对应的密匙，在产品的详细信息中可以找到。</p>
<p><img src="/assets/zh-cn/WechatDev/wechat_08.jpg" alt="Alt text"></p>
<p>gizwitsAppId是机智云中，APP的Id。由于一个产品，可能是多个APP操作的，比如IOS的APP，Android的APP，网站Web应用，甚至微信这样的轻应用，都算是一个APP。因此，在创建产品后，你还可以在为产品绑定一个或多个APP。这里的gizwitsAppId就是我们所绑定APP的Id了。注意，APP必须绑定在产品上，才能使用。</p>
<p>当你调用该方法，就能实现注册匿名用户，已经将用户/设备绑定的操作了。是不是很方便呢？当然，为了方便起见，你还可以进一步封装这个SDK。这里就不展开了。</p>
<h1 id="机智云设备解绑"><a href="#机智云设备解绑" class="headerlink" title="机智云设备解绑"></a>机智云设备解绑</h1><p>解绑操作也是类似的逻辑。当微信推送一条解绑事件消息，我们就会进行解绑操作。同样调用SDK：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Boolean isSuccess = OpenApi.unbindDevice(wechatOpenId, gizwitsAppId, gizwitsDid);</span><br></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th>参数名</th>
<th style="text-align:center">属性</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>WechatOpenId</td>
<td style="text-align:center">String</td>
<td>微信中的OpenId，也就是机智云中注册的匿名用户</td>
</tr>
<tr>
<td>gizwitsAppId</td>
<td style="text-align:center">String</td>
<td>机智云产品所绑定的APP的id</td>
</tr>
</tbody>
</table>
<h1 id="获知设备的在线状态"><a href="#获知设备的在线状态" class="headerlink" title="获知设备的在线状态"></a>获知设备的在线状态</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Boolean isOnline = OpenApi.getDeviceOnlineStatus(wechatOpenId, gizwitsAppId, gizwitsDid);</span><br></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th>参数名</th>
<th style="text-align:center">属性</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>wechatOpenId</td>
<td style="text-align:center">String</td>
<td>微信中的OpenId，也就是机智云中注册的匿名用户</td>
</tr>
<tr>
<td>gizwitsAppId</td>
<td style="text-align:center">String</td>
<td>机智云产品所绑定的APP的id</td>
</tr>
<tr>
<td>gizwitsDid</td>
<td style="text-align:center">String</td>
<td>机智云中的设备ID，设备重置时会重新注册</td>
</tr>
</tbody>
</table>
<h1 id="代码样例"><a href="#代码样例" class="headerlink" title="代码样例"></a>代码样例</h1><p><img src="/assets/zh-cn/WechatDev/wechat_09.png" alt="Alt text"></p>
<p>请注意，在服务器部署的时候，部分开发者会发现部署失败。tomcat中的catalina日志会报错：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">javax.net.ssl.SSLException:java.security.ProviderException:java.security.KeyException</span><br></pre></td></tr></table></figure>
<p>这是因为SDK中采用了Https的方式进行访问。</p>
<p>解决方法是：升级服务器环境中的库：nss。</p>
<h1 id="微信页面操作设备"><a href="#微信页面操作设备" class="headerlink" title="微信页面操作设备"></a>微信页面操作设备</h1><p>好了，我们现在已经绑定了设备，并且也能知道设备的在线的状态了。但是具体如何操作我们的设备？一个良好的体验，当然是具有交互页面的。<br>下面我们就一步步的搭建一个交互页面，来监控我们的设备吧！</p>
<h1 id="获取OpenId"><a href="#获取OpenId" class="headerlink" title="获取OpenId"></a>获取OpenId</h1><p>用户点击页面，我们如何知道是哪个用户呢？我们需要获取当前用户的OpenId来识别时哪个用户。如何获取呢？详细可以看微信的官方文档。</p>
<p>简单的来说，我们向微信的服务器发送授权请求，微信会判断我们请求的URL，是否是授权的域名，如果验证通过，就会转发到我们的URL，并且带上几个参数。</p>
<p>其中最重要的参数，是code，我们通过Code可以获取OpenId。然后，我们再将OpenId返回到页面中。</p>
<p><img src="/assets/zh-cn/WechatDev/wechat_10.png" alt="Alt text"></p>
<h1 id="连接机智云的WebSocket"><a href="#连接机智云的WebSocket" class="headerlink" title="连接机智云的WebSocket"></a>连接机智云的WebSocket</h1><p>对于访问机智云的WebSocket，我们已经封装成了一个JS-SDK。大家只需要引入到页面即可。</p>
<h1 id="初始化gizwits服务"><a href="#初始化gizwits服务" class="headerlink" title="初始化gizwits服务"></a>初始化gizwits服务</h1><p>首先是，构建一个gizwits服务：</p>
<p><img src="/assets/zh-cn/WechatDev/wechat_11.png" alt="Alt text"></p>
<p> 这个gizwits服务，会负责接下来所有的操作，包括：连接设备，读取设备的数据点，操作设备等。</p>
<table>
<thead>
<tr>
<th>参数名</th>
<th style="text-align:center">属性</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>ApiHost</td>
<td style="text-align:center">String</td>
<td>websocket的目标API域名</td>
</tr>
<tr>
<td>CommType</td>
<td style="text-align:center">String</td>
<td>协议格式：custom(自定义协议); attrs_v4(标准数据点协议)</td>
</tr>
<tr>
<td>wechatOpenId</td>
<td style="text-align:center">String</td>
<td>当前访问的微信用户OpenId</td>
</tr>
<tr>
<td>GizwitsAppId</td>
<td style="text-align:center">String</td>
<td>机智云产品所绑定的APP的id</td>
</tr>
</tbody>
</table>
<p>当然，此时gizwits服务，并没有运行起来，我们还需要初始化操作。但在操作之前，我们可以选择配置一个回调函数，它会在初始化结束后，自动运行。</p>
<p><img src="/assets/zh-cn/WechatDev/wechat_12.png" alt="Alt text"></p>
<p>当执行gizwits.init()的时候，就会初始化gizwits服务，并且将匿名用户OpenId绑定的所有设备，放置在回调函数的devices中。</p>
<p>而我们要做的操作，都应该写在回调函数gizwits.onInit里面。</p>
<p>devices列表中的每个设备，都会有六个属性，分别是product_key(产品的Key), dev_alias(设备别名），did(设备ID)，mac，is_online(在线状态）, remark(设备备注)。我们可以根据情况来使用。</p>
<h1 id="设备列表"><a href="#设备列表" class="headerlink" title="设备列表"></a>设备列表</h1><p><img src="/assets/zh-cn/WechatDev/wechat_13.png" alt="Alt text"></p>
<p>上面的操作中，我们已经获取到了设备列表。一般来说，客户可能拥有多个设备，因此，我们在这一步，就可以罗列一个设备列表，由用户自己决定，来操作哪台设备。</p>
<h1 id="连接设备"><a href="#连接设备" class="headerlink" title="连接设备"></a>连接设备</h1><p>想要操作具体哪台设备，我们就去连接哪台设备：gizwits.connect(did)。当然连接成功后，也有一个回调函数：gizwits.onConnected。此回调函数没有传入值。</p>
<p>注意，连接设备之前，必须先初始化。</p>
<p>初始化和连接设备，并非同步操作，因此，如果只是简单的先后执行，可能会出错。因此，建议可以将连接设备的操作，放在初始化的回调函数中，保证执行的先后关系。</p>
<p>连接成功后，我们就可以收到设备上报的数据了。上报的数据通过回调函数：gizwits.onReceivedAttrs。该回调函数会有一个回调值（参数），这个回调值的格式如下：</p>
<p><img src="/assets/zh-cn/WechatDev/wechat_14.png" alt="Alt text"></p>
<p>上面的操作中，我们已经获取到了设备列表。一般来说，客户可能拥有多个设备，因此，我们在这一步，就可以罗列一个设备列表，由用户自己决定，来操作哪台设备。</p>
<p>连接设备</p>
<p>想要操作具体哪台设备，我们就去连接哪台设备：gizwits.connect(did)。当然连接成功后，也有一个回调函数：gizwits.onConnected。此回调函数没有传入值。</p>
<p>注意，连接设备之前，必须先初始化。</p>
<p> 初始化和连接设备，并非同步操作，因此，如果只是简单的先后执行，可能会出错。因此，建议可以将连接设备的操作，放在初始化的回调函数中，保证执行的先后关系。</p>
<p>连接成功后，我们就可以收到设备上报的数据了。上报的数据通过回调函数：gizwits.onReceivedAttrs。该回调函数会有一个回调值（参数），这个回调值的格式如下：</p>
<p><img src="/assets/zh-cn/WechatDev/wechat_15.png" alt="Alt text"></p>
<h1 id="手动读取：设备数据点"><a href="#手动读取：设备数据点" class="headerlink" title="手动读取：设备数据点"></a>手动读取：设备数据点</h1><p>获取设备的数据点，也很简单，只需调用gizwits.read()方法，需要传入did。调用此方法，可以马上获取一次，同样，数据也是通过回调函数 gizwits.onReceivedAttrs，或者gizwits.onReceivedRaw来获取。</p>
<h1 id="连接错误"><a href="#连接错误" class="headerlink" title="连接错误"></a>连接错误</h1><p>当websocket连接错误时，会调用gizwits.onError函数，如有需要，可以重写该函数；回调值是错误信息：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">gizwits.onError = function(value)&#123;</span><br><span class="line">    console.log(<span class="string">"error!!!!:::::"</span>, value.toString());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="设备上下线"><a href="#设备上下线" class="headerlink" title="设备上下线"></a>设备上下线</h1><p>当设备发生上线，或者下线的事件时，gizwits服务，会调用gizwits.onOnlineStatusChanged 回调函数.</p>
<p>回调值有两个参数：did和在线状态(is_online)。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">gizwits.onOnlineStatusChanged = function(value) &#123;</span><br><span class="line">    alert(<span class="string">"设备上下线通知，did="</span>, value.did);</span><br><span class="line">    alert(<span class="string">"设备上下线通知，is_online="</span>, value.is_online);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="控制设备"><a href="#控制设备" class="headerlink" title="控制设备"></a>控制设备</h1><p>最后是，设备的远程控制。</p>
<p>  远程控制的调用方法，如果commType=custom，则使用gizwitsws.send(command)方法，如果commType=attrs_v4，则使用gizwitsws.write(command)方法。</p>
<p>远程控制的值，如果commType=custom，请输入p0，例如[<byte>,<byte>,<byte>…]；如果commType=attrs_v4，请输入datapoints，例如{“power”:true}。</byte></byte></byte></p>
<p>下面是远程控制RBG灯的代码样例：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> command = <span class="string">'&#123;"LED_R": 0, "LED_G": 0, "LED_B": 0&#125;'</span>;</span><br><span class="line">gizwits.write(did, JSON.parse(command));</span><br></pre></td></tr></table></figure>
<p> 当然，使用控制设备的前提是，我们已经连接上了一台设备。</p>
<h1 id="结语"><a href="#结语" class="headerlink" title="结语"></a>结语</h1><p>至此，我们已经实现了微信接入的核心部分。在此教程中，Java-SDK与js-SDK为我们带来了很大的，我们几乎不用关心如何调用机智云的API和websocket，而是直接调用SDK的方法就可以了。</p>
<p>最后，希望大家能多多反馈意见，为更加便捷的开发贡献一份力量。</p>

    </div>
    
    <div class="widget-wrapper">
  <span class="widget">
    <div>
        <a id="share" target="_blank" title="分享">
          <span>分享</span>
        </a>
        <div class="social-share" data-initialized="true">
            <a href="#" class="social-share-icon icon-wechat"></a>
            <a href="#" class="social-share-icon icon-weibo"></a>
            <a href="#" class="social-share-icon icon-qq"></a>
            <a href="#" class="social-share-icon icon-qzone"></a>
            <a href="#" class="social-share-icon icon-douban"></a>
        </div>
    </div>
    <a href="http://y0.cn/docs" target="_blank" title="项目登记">
      <span>项目登记</span>
    </a>
    <a href="https://github.com/gizwits-docs/gizwits-docs/issues" target="_blank" title="问题反馈">
      <span>问题反馈</span>
    </a>
    <a href="#" title="返回顶部"><i class="fa fa-angle-up fa-2x" aria-hidden="true"></i></a>
  </span>
</div>
  </div>
</div>

    <div class="footer">
  <div class="container">
    <p>
      <span><a href="http://www.gizwits.com" target="_blank">机智云首页</a></span>
      <span><a href="http://www.gizwits.com/about-us" target="_blank">关于我们</a></span>
      <span><a href="http://www.gizwits.com/about-us#contact-us" target="_blank">联系我们</a></span>
      <span><a href="http://www.gizwits.com/join-us" target="_blank">加入我们</a></span>
    </p>
    <p>&#169;2011-2017; Gizwits IoT Technology Co., Ltd. 粤ICP备11090211号</p>
  </div>
</div>

    <script src="/js/spin.min.js"></script>
<script src="/js/jquery.min.js"></script>
<script src="/js/jquery.hashchange.min.js"></script>
<script src="/js/clipboard.min.js"></script>
<script src="/js/scrollspy.js"></script>
<script src="/js/social-share.min.js"></script>
<script src="/js/documentation.js?v=d413cf8ceca4865c39c2dabcd3bc0077"></script>


<script type="text/javascript" src="http://webchat.7moor.com/javascripts/7moorInit.js?accessId=b01e0430-943a-11e6-8ad7-636675d9e71f&autoShow=true" async="async"></script>


<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?3787e6b3b29a084fde41f22828d89b7d";
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(hm, s);
})();
</script>
  </body>
</html>